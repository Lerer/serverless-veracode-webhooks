service: sls-sqs-keys
# app and org for use with dashboard.serverless.com
app: sls-sqs-keys-app
org: yaakovlerer

# You can pin your service to only deploy with a specific Serverless version
# Check out our docs for more details
frameworkVersion: '2'

custom:
  prod:
    Stack: ExampleSite
    LogLevel: info
  dev:
    Stack: ExampleSite
    LogLevel: debug
  settings:
    ACCOUNT_ID: "#{AWS::AccountId}"
    TARGET_REGION: ${self:provider.region}
    logLevel: ${self:custom.${self:provider.stage}.LogLevel}

provider:
  name: aws
  runtime: nodejs12.x
  stage: ${opt:stage, 'dev'}
  region: ap-southeast-2
  apiGateway:
    shouldStartNameWithService: true
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - sqs:SendMessage
      Resource: 
        Fn::GetAtt:
          - MyQueue
          - Arn
  environment: ${self:custom.settings}

plugins:
  - serverless-pseudo-parameters

functions:
  hello:
    handler: handler.checkScanStatus
    events:
      - http:
          path: /checkScanStatus
          method: get
  sqsHello:
    handler: handler.sqsSingleScanSample
    events:
      - sqs:
          arn: 
            Fn::GetAtt:
              - MyQueue
              - Arn
          batchSize: 1
resources:
  Resources:
    MyQueue:
      Type: "AWS::SQS::Queue"
      Properties:
        QueueName: "MyQueue"
